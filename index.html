<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>Generador de Etiquetas • GoSpin (v1.6)</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  :root{ --ink:#0f172a; --muted:#64748b; --brand:#0ea5e9; }
  *{ box-sizing:border-box }
  html{ -webkit-text-size-adjust:100%; }
  html, body{ overflow-x:hidden; }
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
    margin:0; background:#fff; color:var(--ink);
  }

  .page{
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
  @media (max-width: 980px){ .page{ padding: 0 12px; } }

  header{ background:#fff; border-bottom:1px solid #e6e8eb; }
  header .page{ display:flex; align-items:center; gap:14px; padding:16px 20px; }
  header h1{ font-size:18px; margin:0; font-weight:800 }
  @media (max-width: 980px){
    header .page{ padding:12px; }
    header h1{ font-size:16px; }
  }

  main .page{
    padding-top:20px; padding-bottom:20px;
    display:grid; grid-template-columns: 420px 1fr;
    gap:20px; align-items:stretch; min-height: calc(100vh - 80px);
  }
  @media (max-width: 980px){
    main .page{ grid-template-columns:1fr; min-height:auto; padding-top:12px; padding-bottom:12px; gap:12px; }
  }

  .card{
    background:#fff; border:1px solid #e6e8eb; border-radius:14px;
    box-shadow:0 10px 20px rgba(0,0,0,.04); height:100%;
    display:flex; flex-direction:column;
  }
  .card .card-body{ padding:18px; display:flex; flex-direction:column; gap:12px; flex:1 }

  .field label{ display:block; font-size:12px; font-weight:800; margin-bottom:6px }
  .field input,.field textarea{
    width:100%; border:1px solid #cfd3d7; border-radius:10px;
    font-size:14px; background:#fff;
  }
  .field input{ height:44px; padding:8px 12px; line-height:1.15 }
  .row{ display:grid; grid-template-columns:1fr 180px; gap:10px }
  .field textarea{ min-height:64px; padding:10px 12px; line-height:1.15; resize:vertical }

  @media (max-width: 980px){ .field input, .field textarea{ font-size:16px; } }

  .actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:auto; }
  button{ appearance:none; border:0; background:var(--brand); color:#fff;
    padding:10px 14px; border-radius:10px; font-weight:800; cursor:pointer }
  button.secondary{ background:#e2e8f0; color:#0f172a }

  @media (max-width: 980px){
    body{ padding-bottom: calc(120px + env(safe-area-inset-bottom, 0px)); }
    .actions{
      position: fixed; left: 12px; right: 12px;
      bottom: calc(28px + env(safe-area-inset-bottom, 0px));
      background:#fff; padding:12px;
      border:1px solid #e5e7eb; border-radius:12px;
      box-shadow:0 6px 24px rgba(0,0,0,0.10);
      justify-content:center; z-index:999;
    }
    .actions button{ flex:1; max-width:200px; }
  }

  .preview-card .card-body{ padding:16px }
  .preview-wrap{
    flex:1; display:flex; justify-content:center; align-items:center;
    padding:8px; overflow:hidden;
  }
  .preview{
    width:100mm; height:150mm;
    background:#fff; color:#000; position:relative;
    border:1px solid #d1d5db; transform-origin:top center;
  }
  .label{
    position:absolute; inset:8mm;
    border:1.6px solid #000; padding:5mm;
    display:flex; flex-direction:column; gap:3.2mm;
  }
  .brand-row{ display:grid; grid-template-columns:1fr auto; align-items:center; }
  .brand-title{ font-weight:900; font-size:12px; letter-spacing:.2px; }
  .brand-logo{ width:23mm; height:auto; object-fit:contain; }

  .fieldbox{ display:flex; flex-direction:column; gap:1mm; }
  .flabel{ font-size:9.2px; font-weight:900; }
  .box{
    border:1px solid #000; padding:2.8mm; min-height:11mm;
    font-size:12px; line-height:1.12; white-space:pre-wrap; word-wrap:break-word;
  }
  .row2{ display:grid; grid-template-columns: 1fr 30mm; gap:3mm; align-items:start; }

  .cp .box{ font-size:15px; text-align:left; font-weight:400; }
  .cel .box{ font-size:12px; text-align:left; font-weight:400; }
  .obs .box{ min-height:16mm; }

  .website{ text-align:center; font-weight:900; font-size:11px; margin-top:auto; }

  @page{ size: 100mm 150mm; margin: 0 }
  @media print{
    header, .card:not(.printable), .preview-wrap { display:none !important }
    body{ background:#fff !important; padding-bottom:0 !important; }
    .preview{ border:0; transform:none !important; }
    .label{ inset:0; border:0; padding:6.5mm; }
  }
</style>
</head>
<body>
  <header>
    <div class="page">
      <h1>Generador de Etiquetas (10×15 cm) • GoSpin (v1.6)</h1>
    </div>
  </header>

  <main>
    <div class="page">
      <!-- FORMULARIO -->
      <section class="card form-card printable">
        <div class="card-body">
          <div class="field">
            <label>REMITENTE</label>
            <input id="f-remitente" maxlength="64" placeholder="(Ingresar únicamente nombre de comercio)"/>
          </div>
          <div class="field">
            <label>NOMBRE COMPLETO DE QUIEN RECIBE</label>
            <input id="f-nombre" maxlength="64" placeholder="(Nombre y Apellido)"/>
          </div>
          <div class="field">
            <label>DOMICILIO</label>
            <input id="f-domicilio" maxlength="90" placeholder="(Calle, Número, Piso/Departamento)"/>
          </div>
          <div class="row">
            <div class="field">
              <label>LOCALIDAD</label>
              <input id="f-localidad" maxlength="48" placeholder="(Ciudad/Localidad)"/>
            </div>
            <div class="field">
              <label>CÓDIGO POSTAL</label>
              <input id="f-cp" inputmode="numeric" maxlength="4" placeholder="(4 dígitos, ej. 1602)"/>
            </div>
          </div>
          <div class="field">
            <label>CELULAR</label>
            <input id="f-cel" inputmode="numeric" maxlength="15" placeholder="(Sólo números, sin + ni guiones)"/>
          </div>
          <div class="field">
            <label>OBSERVACIONES</label>
            <textarea id="f-obs" rows="3" maxlength="220" placeholder="(Frágil, horario de entrega, portería, etc.)"></textarea>
          </div>

          <div class="actions">
            <button id="btn-pdf">Descargar PDF</button>
            <button id="btn-clear" class="secondary">Nueva etiqueta</button>
          </div>
          <p style="font-size:12px; color:#475569; margin:6px 0 0">
            Los campos numéricos permiten sólo dígitos. Los datos no se envían a ningún servidor.
          </p>
        </div>
      </section>

      <!-- PREVIEW -->
      <section class="card preview-card">
        <div class="card-body">
          <div class="preview-wrap">
            <div class="preview" id="preview">
              <div class="label" id="label">
                <div class="brand-row">
                  <div class="brand-title">Etiqueta de Envío • GoSpin</div>
                  <img src="gospinlogo.png" alt="GoSpin" class="brand-logo" />
                </div>

                <div class="fieldbox remitente">
                  <div class="flabel">REMITENTE</div>
                  <div class="box" id="v-remitente"></div>
                </div>
                <div class="fieldbox nombre">
                  <div class="flabel">NOMBRE COMPLETO DE QUIEN RECIBE</div>
                  <div class="box" id="v-nombre"></div>
                </div>
                <div class="fieldbox domicilio">
                  <div class="flabel">DOMICILIO</div>
                  <div class="box" id="v-domicilio"></div>
                </div>
                <div class="row2">
                  <div class="fieldbox loc">
                    <div class="flabel">LOCALIDAD</div>
                    <div class="box" id="v-localidad"></div>
                  </div>
                  <div class="fieldbox cp">
                    <div class="flabel">CÓDIGO POSTAL</div>
                    <div class="box" id="v-cp"></div>
                  </div>
                </div>
                <div class="fieldbox cel">
                  <div class="flabel">CELULAR</div>
                  <div class="box" id="v-cel"></div>
                </div>
                <div class="fieldbox obs">
                  <div class="flabel">OBSERVACIONES</div>
                  <div class="box" id="v-obs"></div>
                </div>
                <div class="website">WWW.GOSPIN.COM.AR</div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

<script>
function $(id){return document.getElementById(id);}
function getVal(id){return ($(id).value||'').trim();}
$('f-cp').addEventListener('input',e=>{e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,4);});
$('f-cel').addEventListener('input',e=>{e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,15);});

function validateCP(){const cp=getVal('f-cp');const ok=/^\d{4}$/.test(cp);$('f-cp').style.borderColor=ok?'#cfd3d7':'#ef4444';return ok;}
function sync(){['remitente','nombre','domicilio','localidad','cp','cel','obs'].forEach(x=>$('v-'+x).textContent=getVal('f-'+x));validateCP();}
['f-remitente','f-nombre','f-domicilio','f-localidad','f-cp','f-cel','f-obs'].forEach(id=>$(id).addEventListener('input',sync));

function resizePreview(){
  const wrap=document.querySelector('.preview-wrap'); const pv=$('preview');
  if(!wrap||!pv) return;
  const real=pv.offsetWidth; const avail=wrap.clientWidth-8;
  pv.style.transform=avail<real?`scale(${avail/real})`:'scale(1)';
}
window.addEventListener('resize',resizePreview);

async function descargarPDF(){
  if(!validateCP()){ alert('El Código Postal debe tener 4 números.'); return; }
  sync();
  const pv=$('preview'); const prev=pv.style.transform; pv.style.transform='none';
  const canvas=await html2canvas(pv,{scale:2,backgroundColor:'#fff'});
  const img=canvas.toDataURL('image/png'); const{jsPDF}=window.jspdf;
  const pdf=new jsPDF({orientation:'p',unit:'mm',format:[100,150]});
  pdf.addImage(img,'PNG',0,0,100,150);
  const nombre=getVal('f-nombre').replace(/[^A-Za-z0-9_\\-]+/g,'_')||'etiqueta';
  const cp=getVal('f-cp')||'0000';
  pdf.save(`etiqueta_gospin_${cp}_${nombre}.pdf`);
  pv.style.transform=prev; resizePreview();
}
$('btn-pdf').addEventListener('click',descargarPDF);

$('btn-clear').addEventListener('click',()=>{
  ['f-remitente','f-nombre','f-domicilio','f-localidad','f-cp','f-cel','f-obs'].forEach(id=>$(id).value='');
  sync(); $('f-remitente').focus();
});

sync(); resizePreview();
</script>
</body>
</html>
