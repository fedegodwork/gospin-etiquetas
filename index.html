<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Generador de Etiquetas • GoSpin</title>
<!-- Librerías para exportar a PDF (cliente): html2canvas + jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
  :root{
    --bg:#0b0c10; --ink:#111; --muted:#666; --brand:#0ea5e9; --brand2:#f59e0b;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; margin:0; background:#f6f7f9; color:var(--ink)}
  header{display:flex; align-items:center; gap:14px; padding:16px 20px; background:white; border-bottom:1px solid #e6e8eb}
  header img{height:40px}
  header h1{font-size:18px; margin:0; font-weight:700}
  main{display:grid; grid-template-columns: 420px 1fr; gap:20px; padding:20px; align-items:start}
  @media (max-width: 980px){ main{grid-template-columns:1fr} }
  .card{background:white; border:1px solid #e6e8eb; border-radius:14px; box-shadow:0 10px 20px rgba(0,0,0,.04);}
  .card .card-body{padding:18px}
  .field{margin-bottom:12px}
  .field label{display:block; font-size:12px; font-weight:700; margin-bottom:6px}
  .field input,.field textarea{width:100%; padding:10px 12px; border:1px solid #cfd3d7; border-radius:10px; font-size:14px}
  .row{display:grid; grid-template-columns:1fr 180px; gap:10px}
  .actions{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
  button{appearance:none; border:0; background:var(--brand); color:white; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
  button.secondary{background:#e2e8f0; color:#0f172a}

  /* Área de vista previa a escala (10x15 cm) */
  .preview-wrap{display:flex; justify-content:center; align-items:flex-start; padding:16px}
  .preview-outer{background:#e5e7eb; padding:16px; border-radius:12px;}
  .preview{width: 100mm; height:150mm; background:white; color:#000; position:relative; border:1px solid #d1d5db;}

  /* Estilos de la etiqueta */
  .label{position:absolute; inset:10px; border:1.5px solid #000; padding:10px;}
  .brand-row{display:flex; justify-content:space-between; align-items:center}
  .brand-row img{height:28px}
  .title{font-weight:800; font-size:12px; text-align:center; margin:6px 0 10px}
  .website{position:absolute; bottom:8px; left:0; right:0; text-align:center; font-weight:800; font-size:11px}
  .fieldbox{margin-bottom:8px}
  .fieldbox .flabel{font-size:9.5px; font-weight:800; margin-bottom:4px}
  .box{border:1px solid #000; padding:6px; min-height:24px; font-size:12px; white-space:pre-wrap; word-wrap:break-word}
  .row2{display:grid; grid-template-columns: 1fr 42mm; gap:6px}
  .cp .box{font-weight:900; font-size:16px; text-align:left}
  .obs .box{min-height:22mm}

  /* Impresión: solo etiqueta, tamaño exacto 10x15 cm */
  @page{ size: 100mm 150mm; margin: 0 }
  @media print{
    header, .card:not(.printable), .preview-outer{ display:none !important }
    body{ background:white }
    .preview{ border:0; }
    .label{ inset:0; border:0; padding:8mm }
  }
</style>
</head>
<body>
  <header class="card printable">
    <img alt="GoSpin" id="logo-head" />
    <h1>Generador de Etiquetas (10×15 cm) • GoSpin</h1>
  </header>
  <main>
    <section class="card printable">
      <div class="card-body">
        <div class="field">
          <label>REMITENTE (INGRESAR UNICAMENTE NOMBRE DE COMERCIO)</label>
          <input id="f-remitente" maxlength="64" placeholder="Ej: Boutique Sol" />
        </div>
        <div class="field">
          <label>NOMBRE COMPLETO DE QUIEN RECIBE</label>
          <input id="f-nombre" maxlength="64" placeholder="Ej: Juan Pérez" />
        </div>
        <div class="field">
          <label>DOMICILIO (CALLE, NUMERO, PISO DEPARTAMENTO)</label>
          <input id="f-domicilio" maxlength="90" placeholder="Ej: Av. Siempre Viva 742, 3° B" />
        </div>
        <div class="row">
          <div class="field">
            <label>LOCALIDAD</label>
            <input id="f-localidad" maxlength="48" placeholder="Ej: Vicente López" />
          </div>
          <div class="field">
            <label>CÓDIGO POSTAL (SOLO NÚMEROS, CUATRO NÚMEROS)</label>
            <input id="f-cp" inputmode="numeric" pattern="\\d{4}" maxlength="4" placeholder="1602" />
          </div>
        </div>
        <div class="field">
          <label>OBSERVACIONES</label>
          <textarea id="f-obs" rows="3" maxlength="220" placeholder="Frágil. Entregar 9-18 hs. Segunda visita sin costo."></textarea>
        </div>
        <div class="actions">
          <button id="btn-preview">Actualizar vista</button>
          <button id="btn-pdf">Descargar PDF</button>
          <button class="secondary" onclick="window.print()">Imprimir / Guardar PDF (del navegador)</button>
        </div>
        <p style="font-size:12px; color:#475569; margin-top:10px">Validación CP: debe ser <b>numérico de 4 dígitos</b>. Los datos quedan solo en el navegador (sin enviar a servidor).</p>
      </div>
    </section>

    <section class="card">
      <div class="preview-wrap">
        <div class="preview" id="preview">
          <div class="label" id="label">
            <div class="brand-row">
              <img id="logo" alt="Logo GoSpin" />
              <div style="font-size:11px; font-weight:800; text-align:right">GoSpin</div>
            </div>
            <div class="title">Etiqueta de Envío • GoSpin</div>

            <div class="fieldbox remitente">
              <div class="flabel">REMITENTE (INGRESAR UNICAMENTE NOMBRE DE COMERCIO)</div>
              <div class="box" id="v-remitente"></div>
            </div>
            <div class="fieldbox nombre">
              <div class="flabel">NOMBRE COMPLETO DE QUIEN RECIBE</div>
              <div class="box" id="v-nombre"></div>
            </div>
            <div class="fieldbox domicilio">
              <div class="flabel">DOMICILIO (CALLE, NUMERO, PISO DEPARTAMENTO)</div>
              <div class="box" id="v-domicilio"></div>
            </div>
            <div class="row2">
              <div class="fieldbox loc">
                <div class="flabel">LOCALIDAD</div>
                <div class="box" id="v-localidad"></div>
              </div>
              <div class="fieldbox cp">
                <div class="flabel">CÓDIGO POSTAL (SOLO NÚMEROS, CUATRO NÚMEROS)</div>
                <div class="box" id="v-cp"></div>
              </div>
            </div>
            <div class="fieldbox obs">
              <div class="flabel">OBSERVACIONES</div>
              <div class="box" id="v-obs"></div>
            </div>

            <div class="website">WWW.GOSPIN.COM.AR</div>
          </div>
        </div>
      </div>
    </section>
  </main>

<script>
// Logo incrustado (base64) para que el archivo sea 100% standalone
const LOGO_DATA_URI = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0CAIAAABEtE...prpGDqGmIj2RA8TMTQ09CwR0xMDM9FmadrGYMA2xtjybrCNsWRZVluWtZSWKq...";

function setLogos(){
  const lg = document.getElementById('logo');
  const lgh = document.getElementById('logo-head');
  if(lg) lg.src = LOGO_DATA_URI;
  if(lgh) lgh.src = LOGO_DATA_URI;
}
setLogos();

function $(id){return document.getElementById(id)}
function getVal(id){return ($(id).value||'').trim()}

function validateCP(){
  const cpEl = $('f-cp');
  const ok = /^\d{4}$/.test(cpEl.value.trim());
  cpEl.style.borderColor = ok ? '#cfd3d7' : '#ef4444';
  return ok;
}

function sync(){
  const remitente = getVal('f-remitente');
  const nombre = getVal('f-nombre');
  const domicilio = getVal('f-domicilio');
  const localidad = getVal('f-localidad');
  const cp = getVal('f-cp');
  const obs = getVal('f-obs');
  $('v-remitente').textContent = remitente;
  $('v-nombre').textContent = nombre;
  $('v-domicilio').textContent = domicilio;
  $('v-localidad').textContent = localidad;
  $('v-cp').textContent = cp;
  $('v-obs').textContent = obs;
  validateCP();
}

['f-remitente','f-nombre','f-domicilio','f-localidad','f-cp','f-obs'].forEach(id=>
  $(id).addEventListener('input', sync)
);
$('btn-preview').addEventListener('click', sync);

async function descargarPDF(){
  if(!validateCP()){ alert('El Código Postal debe tener 4 números.'); return; }
  sync();
  const el = $('preview');
  const canvas = await html2canvas(el, {scale:2, backgroundColor:'#ffffff'});
  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation:'p', unit:'mm', format:[100,150] });
  pdf.addImage(imgData, 'PNG', 0, 0, 100, 150);
  const nombre = getVal('f-nombre').replace(/[^A-Za-z0-9_\-]+/g,'_') || 'etiqueta';
  const cp = getVal('f-cp') || '0000';
  pdf.save(`etiqueta_gospin_${cp}_${nombre}.pdf`);
}
$('btn-pdf').addEventListener('click', descargarPDF);

// Inicializar
sync();
</script>
</body>
</html>
